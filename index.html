<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>胡唐锦 & 吴漾 婚礼邀请函</title>

  <!-- Open Graph / WeChat Share -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="胡唐锦 & 吴漾 婚礼邀请函">
  <meta property="og:description" content="喜乐有分享，共度日月长！2026年2月22日 诚邀您的光临">
  <meta property="og:image" content="https://galfond.site/share_thumb.jpg">
  <meta name="description" content="胡唐锦 & 吴漾 婚礼邀请函 - 2026年2月22日">
  <script src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400&family=Noto+Serif+SC:wght@200;300;400;500;600;700&family=Great+Vibes&display=swap"
    rel="stylesheet">
  <style>
    /* ========== CSS Reset & Base ========== */
    *,
    *::before,
    *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
      overflow-x: hidden;
    }

    body {
      font-family: 'Noto Serif SC', 'Georgia', 'SimSun', serif;
      background: #0D0A06;
      color: #3C3028;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
    }

    /* ========== Color Palette ========== */
    :root {
      --gold: #C9A84C;
      --gold-light: #E2CA7B;
      --gold-dark: #8B6914;
      --cream: #FBF6EC;
      --cream-dark: #F0E6D0;
      --burgundy: #6B2D3E;
      --burgundy-light: #8E3A50;
      --charcoal: #2C2418;
      --warm-white: #FEFCF7;
      --shadow: rgba(107, 45, 62, 0.08);
    }

    /* ========== Scrollbar ========== */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: var(--charcoal);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--gold);
      border-radius: 3px;
    }

    /* ========== Loading Screen ========== */
    .loading-screen {
      position: fixed;
      inset: 0;
      z-index: 9999;
      background: var(--charcoal);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: opacity 0.8s ease, visibility 0.8s ease;
    }

    .loading-screen.hidden {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
    }

    .loading-ornament {
      width: 60px;
      height: 60px;
      border: 2px solid transparent;
      border-top-color: var(--gold);
      border-right-color: var(--gold-light);
      border-radius: 50%;
      animation: spin 1.2s linear infinite;
    }

    .loading-text {
      margin-top: 24px;
      font-family: 'Cormorant Garamond', serif;
      font-size: 14px;
      letter-spacing: 4px;
      color: var(--gold);
      text-transform: uppercase;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* ========== Music Button ========== */
    .music-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 999;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 1px solid var(--gold);
      background: rgba(44, 36, 24, 0.7);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .music-btn:hover {
      background: rgba(44, 36, 24, 0.9);
    }

    .music-btn:active {
      transform: scale(0.92);
    }

    .music-icon {
      font-size: 18px;
      color: var(--gold-light);
      display: inline-block;
    }

    .music-btn.playing .music-icon {
      animation: musicSpin 2.5s linear infinite;
    }

    .music-btn.paused .music-icon {
      animation: none;
    }

    @keyframes musicSpin {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    /* ========== Ornamental Elements ========== */
    .ornament {
      display: block;
      margin: 0 auto;
      text-align: center;
      line-height: 1;
      color: var(--gold);
      font-size: 28px;
      opacity: 0.7;
      user-select: none;
    }

    .ornament-line {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      margin: 24px auto;
      max-width: 320px;
    }

    .ornament-line::before,
    .ornament-line::after {
      content: '';
      flex: 1;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--gold), transparent);
    }

    .ornament-line span {
      color: var(--gold);
      font-size: 18px;
      opacity: 0.8;
    }

    /* ========== Section Common ========== */
    .section {
      min-height: 100vh;
      min-height: 100dvh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    /* ========== Reveal Animation ========== */
    .reveal {
      opacity: 0;
      transform: translateY(40px);
      transition: opacity 0.9s ease, transform 0.9s ease;
    }

    .reveal.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .reveal-delay-1 {
      transition-delay: 0.15s;
    }

    .reveal-delay-2 {
      transition-delay: 0.3s;
    }

    .reveal-delay-3 {
      transition-delay: 0.45s;
    }

    .reveal-delay-4 {
      transition-delay: 0.6s;
    }

    /* ========== 1. HERO / COVER ========== */
    .hero {
      position: relative;
      background: var(--charcoal);
      overflow: hidden;
    }

    .hero-bg {
      position: absolute;
      inset: 0;
      background: url('WIN_1631.jpg') center center / cover no-repeat;
      filter: brightness(0.5);
      transform: scale(1.05);
      transition: transform 8s ease;
    }

    .hero.loaded .hero-bg {
      transform: scale(1);
    }

    .hero-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg,
          rgba(13, 10, 6, 0.3) 0%,
          rgba(13, 10, 6, 0.1) 40%,
          rgba(13, 10, 6, 0.5) 80%,
          rgba(13, 10, 6, 0.85) 100%);
    }

    .hero-content {
      position: relative;
      z-index: 2;
      text-align: center;
      padding: 60px 24px;
      color: var(--cream);
    }

    .hero-subtitle {
      font-family: 'Cormorant Garamond', serif;
      font-size: 13px;
      font-weight: 300;
      letter-spacing: 6px;
      text-transform: uppercase;
      color: var(--gold-light);
      margin-bottom: 32px;
    }

    .hero-names {
      font-size: 36px;
      font-weight: 600;
      letter-spacing: 6px;
      line-height: 1.6;
      margin-bottom: 8px;
    }

    .hero-names .amp {
      display: block;
      font-family: 'Great Vibes', 'Cormorant Garamond', cursive;
      font-size: 48px;
      font-weight: 400;
      color: var(--gold-light);
      margin: 4px 0;
      letter-spacing: 0;
    }

    .hero-date {
      font-family: 'Cormorant Garamond', serif;
      font-size: 15px;
      font-weight: 300;
      letter-spacing: 4px;
      color: var(--gold-light);
      margin-top: 36px;
    }

    .hero-scroll {
      position: absolute;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      color: var(--gold-light);
      opacity: 0.6;
      animation: float 2.5s ease-in-out infinite;
      cursor: pointer;
    }

    .hero-scroll span {
      font-size: 11px;
      letter-spacing: 3px;
      font-family: 'Cormorant Garamond', serif;
    }

    .scroll-arrow {
      width: 20px;
      height: 20px;
      border-right: 1px solid var(--gold-light);
      border-bottom: 1px solid var(--gold-light);
      transform: rotate(45deg);
    }

    @keyframes float {

      0%,
      100% {
        transform: translateX(-50%) translateY(0);
      }

      50% {
        transform: translateX(-50%) translateY(10px);
      }
    }

    /* ========== 2. QUOTE SECTION ========== */
    .quote-section {
      background: var(--warm-white);
      padding: 80px 24px;
      text-align: center;
    }

    .quote-icon {
      font-family: 'Cormorant Garamond', serif;
      font-size: 48px;
      font-weight: 300;
      color: var(--gold);
      line-height: 1;
      opacity: 0.6;
      margin-bottom: 24px;
    }

    .quote-text {
      font-size: 22px;
      font-weight: 400;
      line-height: 2;
      letter-spacing: 4px;
      color: var(--charcoal);
      max-width: 420px;
      margin: 0 auto;
    }

    /* ========== 3. PHOTO FEATURE ========== */
    .photo-feature {
      width: 100%;
      background: var(--charcoal);
      padding: 0;
      overflow: hidden;
    }

    .photo-feature img {
      width: 100%;
      height: 100vh;
      height: 100dvh;
      object-fit: cover;
      display: block;
      opacity: 0;
      transition: opacity 1.2s ease;
    }

    .photo-feature img.loaded {
      opacity: 1;
    }

    /* ========== 4. DETAILS SECTION ========== */
    .details-section {
      background: var(--warm-white);
      padding: 80px 24px;
      text-align: center;
    }

    .details-header {
      font-family: 'Cormorant Garamond', serif;
      font-size: 13px;
      font-weight: 400;
      letter-spacing: 6px;
      text-transform: uppercase;
      color: var(--gold-dark);
      margin-bottom: 40px;
    }

    .details-card {
      max-width: 460px;
      margin: 0 auto;
      background: var(--warm-white);
      position: relative;
      padding: 48px 32px;
    }

    .details-card::before {
      content: '';
      position: absolute;
      inset: 0;
      border: 1px solid var(--gold);
      opacity: 0.35;
    }

    .details-card::after {
      content: '';
      position: absolute;
      inset: 6px;
      border: 1px solid var(--gold);
      opacity: 0.15;
    }

    .details-names {
      font-size: 28px;
      font-weight: 600;
      letter-spacing: 3px;
      color: var(--charcoal);
      line-height: 1.8;
    }

    .details-names .amp {
      font-family: 'Great Vibes', cursive;
      font-size: 36px;
      color: var(--gold);
      display: inline-block;
      margin: 0 12px;
      vertical-align: middle;
    }

    .details-label {
      font-size: 11px;
      letter-spacing: 4px;
      color: var(--gold-dark);
      text-transform: uppercase;
      font-family: 'Cormorant Garamond', serif;
      margin-top: 36px;
      margin-bottom: 8px;
    }

    .details-date {
      font-size: 18px;
      font-weight: 500;
      color: var(--charcoal);
      letter-spacing: 2px;
      line-height: 1.8;
    }

    .details-lunar {
      font-size: 14px;
      color: var(--burgundy);
      letter-spacing: 2px;
      margin-top: 2px;
    }

    .details-time {
      font-size: 20px;
      font-weight: 500;
      color: var(--charcoal);
      letter-spacing: 2px;
      margin-top: 4px;
    }

    .details-venue-name {
      font-size: 18px;
      font-weight: 600;
      color: var(--charcoal);
      letter-spacing: 2px;
      margin-top: 4px;
    }

    .details-venue-floor {
      font-size: 14px;
      color: #7A6E60;
      letter-spacing: 2px;
      margin-top: 4px;
    }

    /* ========== 5. GALLERY ========== */
    .gallery-section {
      background: var(--charcoal);
      padding: 80px 0;
      overflow: hidden;
    }

    .gallery-header {
      font-family: 'Cormorant Garamond', serif;
      font-size: 13px;
      font-weight: 400;
      letter-spacing: 6px;
      text-transform: uppercase;
      color: var(--gold);
      text-align: center;
      margin-bottom: 48px;
    }

    .gallery-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4px;
      padding: 0 4px;
      max-width: 800px;
      margin: 0 auto;
    }

    .gallery-item {
      position: relative;
      overflow: hidden;
      aspect-ratio: 3/4;
      cursor: pointer;
    }

    .gallery-item.wide {
      grid-column: span 2;
      aspect-ratio: 16/10;
    }

    .gallery-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.8s ease, filter 0.5s ease;
      filter: brightness(0.85);
    }

    .gallery-item:hover img {
      transform: scale(1.05);
      filter: brightness(1);
    }

    .gallery-item::after {
      content: '';
      position: absolute;
      inset: 0;
      border: 1px solid var(--gold);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease;
      margin: 8px;
    }

    .gallery-item:hover::after {
      opacity: 0.5;
    }

    /* ========== 6. CLOSING ========== */
    .closing-section {
      background: var(--warm-white);
      padding: 80px 24px;
      text-align: center;
    }

    .closing-date-big {
      font-family: 'Cormorant Garamond', serif;
      font-size: 80px;
      font-weight: 300;
      color: var(--gold);
      line-height: 1;
      letter-spacing: -2px;
    }

    .closing-month {
      font-family: 'Cormorant Garamond', serif;
      font-size: 18px;
      font-weight: 400;
      letter-spacing: 8px;
      text-transform: uppercase;
      color: var(--gold-dark);
      margin-top: 8px;
    }

    .closing-names {
      font-size: 20px;
      font-weight: 500;
      letter-spacing: 4px;
      color: var(--charcoal);
      margin-top: 32px;
      line-height: 2;
    }

    .closing-msg {
      font-size: 15px;
      color: #7A6E60;
      letter-spacing: 2px;
      margin-top: 24px;
      line-height: 2;
    }

    /* ========== 7. FOOTER PHOTO ========== */
    .footer-photo {
      width: 100%;
      position: relative;
      overflow: hidden;
    }

    .footer-photo img {
      width: 100%;
      height: 60vh;
      object-fit: cover;
      display: block;
      filter: brightness(0.6);
    }

    .footer-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(180deg, rgba(13, 10, 6, 0.2) 0%, rgba(13, 10, 6, 0.6) 100%);
    }

    .footer-text {
      font-family: 'Cormorant Garamond', serif;
      font-size: 14px;
      letter-spacing: 5px;
      color: var(--gold-light);
      text-transform: uppercase;
    }

    .footer-heart {
      font-size: 24px;
      color: var(--gold-light);
      margin: 16px 0;
      opacity: 0.6;
    }

    /* ========== Lightbox ========== */
    .lightbox {
      position: fixed;
      inset: 0;
      z-index: 1000;
      background: rgba(13, 10, 6, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: all 0.4s ease;
      cursor: pointer;
    }

    .lightbox.active {
      opacity: 1;
      visibility: visible;
    }

    .lightbox img {
      max-width: 92vw;
      max-height: 90vh;
      object-fit: contain;
      border: 1px solid rgba(201, 168, 76, 0.2);
      transform: scale(0.9);
      transition: transform 0.4s ease;
    }

    .lightbox.active img {
      transform: scale(1);
    }

    .lightbox-close {
      position: absolute;
      top: 20px;
      right: 24px;
      font-size: 28px;
      color: var(--gold-light);
      cursor: pointer;
      z-index: 1001;
      font-family: 'Cormorant Garamond', serif;
      font-weight: 300;
    }

    /* ========== Responsive ========== */
    @media (min-width: 768px) {
      .hero-names {
        font-size: 48px;
        letter-spacing: 10px;
      }

      .hero-names .amp {
        font-size: 60px;
      }

      .quote-text {
        font-size: 26px;
        letter-spacing: 6px;
      }

      .details-names {
        font-size: 32px;
      }

      .closing-date-big {
        font-size: 120px;
      }

      .gallery-grid {
        gap: 8px;
        padding: 0 8px;
      }
    }

    @media (max-width: 375px) {
      .hero-names {
        font-size: 28px;
        letter-spacing: 4px;
      }

      .hero-names .amp {
        font-size: 36px;
      }

      .quote-text {
        font-size: 18px;
      }

      .details-card {
        padding: 36px 20px;
      }

      .closing-date-big {
        font-size: 64px;
      }
    }
  </style>
</head>

<body>

  <!-- BGM Audio -->
  <audio id="bgm" src="bgm.mp3" loop preload="auto"></audio>

  <!-- Music Toggle Button -->
  <div class="music-btn paused" id="musicBtn" onclick="toggleMusic()">
    <span class="music-icon">&#9835;</span>
  </div>

  <!-- Loading Screen -->
  <div class="loading-screen" id="loadingScreen">
    <div class="loading-ornament"></div>
    <div class="loading-text">Wedding Invitation</div>
  </div>

  <!-- ==================== 1. HERO ==================== -->
  <section class="section hero" id="hero">
    <div class="hero-bg"></div>
    <div class="hero-overlay"></div>
    <div class="hero-content">
      <div class="hero-subtitle reveal">Wedding Invitation</div>
      <div class="ornament-line reveal reveal-delay-1">
        <span>&loz;</span>
      </div>
      <h1 class="hero-names reveal reveal-delay-2">
        胡唐锦
        <span class="amp">&amp;</span>
        吴漾
      </h1>
      <div class="ornament-line reveal reveal-delay-3">
        <span>&loz;</span>
      </div>
      <div class="hero-date reveal reveal-delay-4">
        February 22, 2026 &nbsp;&middot;&nbsp; Sunday
      </div>
    </div>
    <div class="hero-scroll" onclick="document.getElementById('quote').scrollIntoView({behavior:'smooth'})">
      <span>Scroll</span>
      <div class="scroll-arrow"></div>
    </div>
  </section>

  <!-- ==================== 2. QUOTE ==================== -->
  <section class="quote-section" id="quote">
    <div class="quote-icon reveal" style="font-size: 56px;">&#9813;</div>
    <p class="quote-text reveal reveal-delay-1">喜乐有分享<br>共度日月长</p>
    <div class="ornament-line reveal reveal-delay-2"><span>&loz;</span></div>
  </section>

  <!-- ==================== 3. FEATURE PHOTO ==================== -->
  <section class="photo-feature">
    <img src="WIN_2622.jpg" alt="Wedding Photo" onload="this.classList.add('loaded')">
  </section>

  <!-- ==================== 4. WEDDING DETAILS ==================== -->
  <section class="details-section" id="details">
    <div class="details-header reveal">Celebration Details</div>
    <div class="details-card reveal reveal-delay-1">
      <div class="details-names">
        胡唐锦 <span class="amp">&amp;</span> 吴漾
      </div>

      <div class="ornament-line"><span>&loz;</span></div>

      <div class="details-label">Date</div>
      <div class="details-date">公历 二〇二六年二月二十二日</div>
      <div class="details-lunar">农历正月初六 &nbsp;&middot;&nbsp; 星期天</div>

      <div style="margin-top:28px"></div>

      <div class="details-label">Time</div>
      <div class="details-time">午宴 &nbsp;上午 11:18</div>

      <div style="margin-top:28px"></div>

      <div class="details-label">Venue</div>
      <div class="details-venue-name">长沙JW万豪酒店</div>
      <div class="details-venue-floor">六楼宴会厅</div>

      <div class="ornament-line" style="margin-top:36px"><span>&loz;</span></div>

      <div style="font-size:13px;color:var(--burgundy);letter-spacing:2px;line-height:2;">
        诚邀您拨冗出席<br>共同见证我们的幸福时刻
      </div>
    </div>
  </section>

  <!-- ==================== 5. FEATURE PHOTO 2 ==================== -->
  <section class="photo-feature">
    <img src="WIN_2731.jpg" alt="Wedding Photo" onload="this.classList.add('loaded')">
  </section>

  <!-- ==================== 6. GALLERY ==================== -->
  <section class="gallery-section" id="gallery">
    <div class="gallery-header reveal">Our Moments</div>
    <div class="gallery-grid">
      <div class="gallery-item reveal" onclick="openLightbox(this)">
        <img src="WIN_2696.jpg" alt="Church Interior" loading="lazy">
      </div>
      <div class="gallery-item reveal reveal-delay-1" onclick="openLightbox(this)">
        <img src="WIN_2141.jpg" alt="Classic Portrait" loading="lazy">
      </div>
      <div class="gallery-item wide reveal reveal-delay-2" onclick="openLightbox(this)">
        <img src="WIN_2849.jpg" alt="Church Exterior with Petals" loading="lazy">
      </div>
      <div class="gallery-item reveal" onclick="openLightbox(this)">
        <img src="WIN_1631.jpg" alt="Formal Portrait" loading="lazy">
      </div>
      <div class="gallery-item reveal reveal-delay-1" onclick="openLightbox(this)">
        <img src="WIN_2622.jpg" alt="Grand Steps" loading="lazy">
      </div>
    </div>
  </section>

  <!-- ==================== 7. CLOSING ==================== -->
  <section class="closing-section" id="closing">
    <div class="closing-date-big reveal">22</div>
    <div class="closing-month reveal reveal-delay-1">February &nbsp;&middot;&nbsp; 2026</div>
    <div class="ornament-line reveal reveal-delay-2"><span>&loz;</span></div>
    <div class="closing-names reveal reveal-delay-2">
      胡唐锦 &nbsp;&amp;&nbsp; 吴漾
    </div>
    <div class="closing-msg reveal reveal-delay-3">
      恭候您的光临
    </div>
  </section>

  <!-- ==================== 8. FOOTER PHOTO ==================== -->
  <section class="footer-photo">
    <img src="WIN_2731.jpg" alt="Footer Photo" loading="lazy">
    <div class="footer-overlay">
      <div class="footer-text reveal">Tangjin & Yang</div>
      <div class="footer-heart reveal reveal-delay-1">&hearts;</div>
      <div class="footer-text reveal reveal-delay-2">2026.02.22</div>
    </div>
  </section>

  <!-- ==================== LIGHTBOX ==================== -->
  <div class="lightbox" id="lightbox" onclick="closeLightbox()">
    <div class="lightbox-close">&times;</div>
    <img id="lightboxImg" src="" alt="Photo">
  </div>

  <!-- ==================== SCRIPTS ==================== -->
  <script>
    // ===== Celebration Effect (Confetti) =====
    const GOLD_COLORS = ['#C9A84C', '#E2CA7B', '#8B6914', '#FBF6EC'];

    // 1. 强力侧喷效果 (用于开场和关键节点)
    function blastConfetti() {
      const count = 40;
      const defaults = { origin: { y: 0.7 }, colors: GOLD_COLORS };

      function fire(particleRatio, opts) {
        confetti({
          ...defaults,
          ...opts,
          particleCount: Math.floor(count * particleRatio)
        });
      }

      fire(0.25, { spread: 26, startVelocity: 55, origin: { x: 0, y: 0.8 }, angle: 60 });
      fire(0.25, { spread: 26, startVelocity: 55, origin: { x: 1, y: 0.8 }, angle: 120 });
    }

    // 2. 持续缓慢飘落效果 (浪漫氛围)
    function startSnowing() {
      const duration = 15 * 1000;
      const animationEnd = Date.now() + duration;
      const defaults = { startVelocity: 0, spread: 360, ticks: 60, zIndex: 0, colors: GOLD_COLORS };

      function randomInRange(min, max) {
        return Math.random() * (max - min) + min;
      }

      const interval = setInterval(function () {
        const timeLeft = animationEnd - Date.now();

        if (timeLeft <= 0) {
          return clearInterval(interval);
        }

        const particleCount = 3;
        confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } });
        confetti({ ...defaults, particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } });
      }, 250);
    }

    // 兼容旧调用名
    function startCelebration() {
      blastConfetti();
      startSnowing();
    }

    // ===== BGM Control =====
    var bgm = document.getElementById('bgm');
    var musicBtn = document.getElementById('musicBtn');
    var musicStarted = false;

    function playMusic() {
      var p = bgm.play();
      if (p !== undefined) {
        p.then(function () {
          musicStarted = true;
          musicBtn.classList.remove('paused');
          musicBtn.classList.add('playing');
        }).catch(function () {
          // Autoplay blocked, wait for user interaction
        });
      }
    }

    function toggleMusic() {
      if (bgm.paused) {
        bgm.play().then(function () {
          musicStarted = true;
          musicBtn.classList.remove('paused');
          musicBtn.classList.add('playing');
          startCelebration(); // 播放音乐时触发粒子效果
        }).catch(function () { });
      } else {
        bgm.pause();
        musicBtn.classList.remove('playing');
        musicBtn.classList.add('paused');
      }
    }

    // WeChat auto-play: use WeixinJSBridgeReady event
    if (typeof WeixinJSBridge !== 'undefined') {
      WeixinJSBridge.invoke('getNetworkType', {}, function () { playMusic(); });
    } else {
      document.addEventListener('WeixinJSBridgeReady', function () {
        WeixinJSBridge.invoke('getNetworkType', {}, function () { playMusic(); });
      }, false);
    }

    // General browsers: play on first user interaction
    function onFirstInteraction() {
      if (!musicStarted) {
        playMusic();
        startCelebration(); // 第一次交互触发粒子效果
      }
      document.removeEventListener('touchstart', onFirstInteraction);
      document.removeEventListener('click', onFirstInteraction);
    }
    document.addEventListener('touchstart', onFirstInteraction, { once: true });
    document.addEventListener('click', onFirstInteraction, { once: true });

    // Also try autoplay after page load
    window.addEventListener('load', function () {
      setTimeout(playMusic, 1000);
    });

    // ===== Loading screen =====
    window.addEventListener('load', function () {
      setTimeout(function () {
        document.getElementById('loadingScreen').classList.add('hidden');
        document.getElementById('hero').classList.add('loaded');
        startCelebration(); // 加载完成直接触发一次
      }, 800);
    });

    // Fallback: remove loading after 4s max
    setTimeout(function () {
      document.getElementById('loadingScreen').classList.add('hidden');
      document.getElementById('hero').classList.add('loaded');
    }, 4000);

    // ===== Intersection Observer for reveal animations & Scroll-triggered Confetti =====
    var observer = new IntersectionObserver(function (entries) {
      entries.forEach(function (entry) {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');

          // 当特定的重要章节（如相册、详情）进入视野时，触发一次喷射
          if (entry.target.id === 'details' || entry.target.id === 'gallery' || entry.target.id === 'closing') {
            blastConfetti();
          }
        }
      });
    }, { threshold: 0.15, rootMargin: '0px 0px -40px 0px' });

    document.querySelectorAll('.reveal').forEach(function (el) {
      observer.observe(el);
    });

    // 全局启动背景“金箔雨”
    startSnowing();
    // 页面每隔 20 秒循环一次背景金箔雨，确保长久停留也有氛围
    setInterval(startSnowing, 20000);

    // ===== Lightbox =====
    function openLightbox(item) {
      var src = item.querySelector('img').src;
      document.getElementById('lightboxImg').src = src;
      document.getElementById('lightbox').classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    function closeLightbox() {
      document.getElementById('lightbox').classList.remove('active');
      document.body.style.overflow = '';
    }
    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape') closeLightbox();
    });

    // ===== WeChat JS-SDK Integration =====
    (function () {
      const shareData = {
        title: '胡唐锦 & 吴漾 婚礼邀请函',
        desc: '喜乐有分享，共度日月长！2026年2月22日 诚邀您的光临',
        link: 'https://galfond.site/',
        imgUrl: 'https://galfond.site/share_thumb.jpg'
      };

      async function initWeChat() {
        try {
          // Use the current page URL for signature as required by WeChat
          const currentUrl = window.location.href.split('#')[0];
          const response = await fetch(`https://wx-sign.anlaganlag.workers.dev/api/wx-sign?url=${encodeURIComponent(currentUrl)}`);
          const data = await response.json();

          if (data.appId) {
            wx.config({
              debug: false, // 部署时关闭调试模式
              appId: data.appId,
              timestamp: data.timestamp,
              nonceStr: data.nonceStr,
              signature: data.signature,
              jsApiList: [
                'updateAppMessageShareData',
                'updateTimelineShareData',
                'onMenuShareTimeline',
                'onMenuShareAppMessage'
              ]
            });

            wx.ready(function () {
              // New API
              wx.updateAppMessageShareData(shareData);
              wx.updateTimelineShareData(shareData);
              // Legacy API (for older WeChat versions)
              wx.onMenuShareTimeline(shareData);
              wx.onMenuShareAppMessage(shareData);
            });

            wx.error(function (res) {
              console.error('WeChat SDK error:', res);
            });
          }
        } catch (err) {
          console.error('Failed to initialize WeChat SDK:', err);
        }
      }

      if (/MicroMessenger/i.test(navigator.userAgent)) {
        initWeChat();
      }
    })();
  </script>
</body>

</html>